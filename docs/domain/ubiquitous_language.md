# ユビキタス言語（Ubiquitous Language）

プロンプト管理ドメインにおける共通言語定義

## コアコンセプト

### プロンプト（Prompt）
AIに送信する指示文の集合体。ユーザーの目的を達成するための構造化されたテキスト。

**構成要素:**
- **ID**: プロンプトを一意に識別するUUID
- **Content**: プロンプトの実際の内容
- **Metadata**: バージョンや作成日時などの管理情報
- **History**: 変更履歴の記録

### ユーザー入力（UserInput）
プロンプトを生成するためにユーザーが提供する情報。

**必須要素:**
- **Goal（ゴール）**: 達成したい目的
- **Context（コンテキスト）**: 使用される状況や背景

**オプション要素:**
- **Constraints（制約条件）**: 満たすべき条件のリスト
- **Examples（例）**: 参考となる入出力の例

### プロンプトコンテンツ（PromptContent）
実際のプロンプト文章と関連情報。

**要素:**
- **Template（テンプレート）**: 変数を含むプロンプトの雛形
- **Variables（変数）**: テンプレート内で置換される変数名のリスト
- **System Message（システムメッセージ）**: AIの役割を定義するメッセージ

### プロンプトメタデータ（PromptMetadata）
プロンプトの管理情報。

**属性:**
- **Version（バージョン）**: プロンプトの改訂番号
- **Status（ステータス）**: draft（下書き）、saved（保存済み）、published（公開済み）
- **Created At（作成日時）**: プロンプトが作成された日時
- **Updated At（更新日時）**: 最後に更新された日時
- **Created By（作成者）**: プロンプトを作成したユーザーのID

## ドメインサービス

### プロンプト生成サービス（PromptGenerationService）
ユーザー入力からプロンプトを自動生成するサービス。

**主要機能:**
- **generate_prompt**: 基本的なプロンプト生成
- **generate_prompt_for_openai**: OpenAI向けに最適化されたプロンプト生成
- **improve_prompt**: 既存プロンプトの改善
- **validate_prompt**: プロンプトの妥当性検証

## ビジネスルール

### プロンプト作成ルール
1. **ゴールは必須**: プロンプトを作成するには必ずゴールが必要
2. **自動バージョニング**: 内容が更新されるたびにバージョンが自動的にインクリメント
3. **履歴保持**: すべての変更操作は履歴として記録される

### ステータス遷移
```
draft（下書き） → saved（保存済み） → published（公開済み）
```
- 初期状態は必ず「draft」
- 保存準備が整うと「saved」に遷移
- 将来的に「published」状態をサポート予定

### 変数の整合性
- テンプレート内のプレースホルダー（{変数名}）と変数リストは完全に一致する必要がある
- 不一致の場合はエラーとなる

## 用語集

| 用語 | 英語 | 説明 |
|------|------|------|
| プロンプト | Prompt | AIへの指示文 |
| ゴール | Goal | 達成したい目的 |
| コンテキスト | Context | 使用状況・背景 |
| 制約条件 | Constraints | 満たすべき条件 |
| テンプレート | Template | 変数を含む雛形 |
| 変数 | Variables | 置換可能な部分 |
| システムメッセージ | System Message | AIの役割定義 |
| バージョン | Version | 改訂番号 |
| ステータス | Status | 管理状態 |
| 履歴 | History | 変更記録 |

## 使用例

### ユーザー入力の例
```python
user_input = UserInput(
    goal="商品レビューの要約を生成する",
    context="ECサイトの商品ページで購入検討者向けに表示",
    constraints=[
        "最大200文字",
        "ポジティブ・ネガティブ両方の意見を含む",
        "中立的な視点"
    ],
    examples=[
        "入力: レビューテキスト群",
        "出力: バランスの取れた要約文"
    ]
)
```

### 生成されるプロンプトテンプレートの例
```
# タスク
商品レビューの要約を生成する

# コンテキスト
ECサイトの商品ページで購入検討者向けに表示

# 要件
1. 最大200文字
2. ポジティブ・ネガティブ両方の意見を含む
3. 中立的な視点

# 入力
{reviews}

# 出力
以下に要約を記述します:
```

## 今後の拡張予定

- **評価機能**: プロンプトの品質を自動評価（現在は対象外）
- **LLMプロバイダー拡張**: OpenAI以外のプロバイダー対応（現在はOpenAIのみ）
- **協調編集**: 複数ユーザーによる同時編集機能
- **バージョン管理**: Git風のブランチ・マージ機能